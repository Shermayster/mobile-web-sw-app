'use strict'; /* eslint-env browser, no-unused-vars: "off" */
/* global  DBHelper, google */
/* */
var restaurants = void 0;
var neighborhoods = void 0;
var cuisines = void 0;
var map = void 0;
var markers = [];

/**
                   * Add service worker to main page
                   */

if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('./sw.js').then(function () {
    console.log('service worker registered!');
  }).
  catch(function (err) {
    console.log(err);
  });
}

/**
   * Set cuisines HTML.
   */
var fillCuisinesHTML = function fillCuisinesHTML() {
  var select = document.getElementById('cuisines-select');
  cuisines.forEach(function (cuisine) {
    var option = document.createElement('option');
    option.innerHTML = cuisine;
    option.value = cuisine;
    select.append(option);
  });
};

/**
    * Fetch all cuisines and set their HTML.
    */
var fetchCuisines = function fetchCuisines() {
  DBHelper.fetchCuisines(function (error, cuisines) {
    if (error) {
      // Got an error!
      console.error(error);
    } else {
      cuisines = cuisines;
      fillCuisinesHTML();
    }
  });
};

/**
    * Set neighborhoods HTML.
    */
var fillNeighborhoodsHTML = function fillNeighborhoodsHTML() {
  var select = document.getElementById('neighborhoods-select');
  neighborhoods.forEach(function (neighborhood) {
    var option = document.createElement('option');
    option.innerHTML = neighborhood;
    option.value = neighborhood;
    select.append(option);
  });
};

var appendRestaurantImage = function appendRestaurantImage(restaurant, li) {
  var image = document.createElement('img');
  image.className = 'restaurant-img';
  image.src = DBHelper.imageUrlForRestaurant(restaurant);
  image.alt = 'Restaurant: ' + restaurant.name;
  li.append(image);
};

var appendRestaurantTitle = function appendRestaurantTitle(restaurant, li) {
  var name = document.createElement('h3');
  name.innerHTML = restaurant.name;
  li.append(name);
};

var appendRestaurantNeighborhood = function appendRestaurantNeighborhood(restaurant, li) {
  var neighborhood = document.createElement('p');
  neighborhood.innerHTML = restaurant.neighborhood;
  li.append(neighborhood);
};

var appendRestaurantAddress = function appendRestaurantAddress(restaurant, li) {
  var address = document.createElement('p');
  address.innerHTML = restaurant.address;
  li.append(address);
};

var appendRestaurantDetails = function appendRestaurantDetails(restaurant, li) {
  var more = document.createElement('a');
  more.innerHTML = 'View Details';
  more.href = DBHelper.urlForRestaurant(restaurant);
  li.append(more);
};

/**
    * Add markers for current restaurants to the map.
    */
var addMarkersToMap = function addMarkersToMap() {
  restaurants.forEach(function (restaurant) {
    // Add marker to the map
    var marker = DBHelper.mapMarkerForRestaurant(restaurant, self.map);
    google.maps.event.addListener(marker, 'click', function () {
      window.location.href = marker.url;
    });
    self.markers.push(marker);
  });
};

var appendRestaurantItems = function appendRestaurantItems(restaurant, li) {
  appendRestaurantImage(restaurant, li);
  appendRestaurantTitle(restaurant, li);
  appendRestaurantNeighborhood(restaurant, li);
  appendRestaurantAddress(restaurant, li);
  appendRestaurantDetails(restaurant, li);
};

/**
    * Create restaurant HTML.
    * @param {*} restaurant restaurna object
    * @return {*} HTML Element
    */
var createRestaurantHTML = function createRestaurantHTML(restaurant) {
  var li = document.createElement('li');
  appendRestaurantItems(restaurant, li);
  return li;
};

/**
    * Create all restaurants HTML and add them to the webpage.
    */
var fillRestaurantsHTML = function fillRestaurantsHTML() {
  var ul = document.getElementById('restaurants-list');
  restaurants.forEach(function (restaurant) {
    ul.append(createRestaurantHTML(restaurant));
  });
  addMarkersToMap();
};
/**
    * Fetch all neighborhoods and set their HTML.
    */
var fetchNeighborhoods = function fetchNeighborhoods() {
  DBHelper.fetchNeighborhoods(function (error, neighborhoodsList) {
    if (error) {
      // Got an error
      console.error(error);
    } else {
      neighborhoods = neighborhoodsList;
      fillNeighborhoodsHTML();
    }
  });
};

/**
    * @desc Clear current restaurants, their HTML and remove their map markers.
    * @param {*} restaurantsList todo: add list description
    */
var resetRestaurants = function resetRestaurants(restaurantsList) {
  // Remove all restaurants
  restaurants = [];
  var ul = document.getElementById('restaurants-list');
  ul.innerHTML = '';

  // Remove all map markers
  markers.forEach(function (m) {return m.setMap(null);});
  markers = [];
  restaurants = restaurantsList;
};

/**
    * Update page and map for current restaurants.
    */
var updateRestaurants = function updateRestaurants() {
  var cSelect = document.getElementById('cuisines-select');
  var nSelect = document.getElementById('neighborhoods-select');

  var cIndex = cSelect.selectedIndex;
  var nIndex = nSelect.selectedIndex;

  var cuisine = cSelect[cIndex].value;
  var neighborhood = nSelect[nIndex].value;

  DBHelper.fetchRestaurantByCuisineAndNeighborhood(cuisine, neighborhood,
  function (error, restaurantsList) {
    if (error) {
      // Got an error!
      console.error(error);
    } else {
      resetRestaurants(restaurantsList);
      fillRestaurantsHTML();
    }
  });
};

/**
    * Fetch neighborhoods and cuisines as soon as the page is loaded.
    */
document.addEventListener('DOMContentLoaded', function () {
  fetchNeighborhoods();
  fetchCuisines();
});

/**
     * Initialize Google map, called from HTML.
     */
window.initMap = function () {
  var loc = {
    lat: 40.722216,
    lng: -73.987501 };

  map = new google.maps.Map(document.getElementById('map'), {
    zoom: 12,
    center: loc,
    scrollwheel: false });

  var loadedMap = map;
  // disable keyboard navigation for google maps
  google.maps.event.addListener(loadedMap, 'tilesloaded', function () {
    document.querySelectorAll('#map a').forEach(function (item) {
      item.setAttribute('tabindex', '-1');
    });
    document.querySelectorAll('#map area').forEach(function (item) {
      item.setAttribute('tabindex', '-1');
    });
  });
  updateRestaurants();
};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsicmVzdGF1cmFudHMiLCJuZWlnaGJvcmhvb2RzIiwiY3Vpc2luZXMiLCJtYXAiLCJtYXJrZXJzIiwibmF2aWdhdG9yIiwic2VydmljZVdvcmtlciIsInJlZ2lzdGVyIiwidGhlbiIsImNvbnNvbGUiLCJsb2ciLCJjYXRjaCIsImVyciIsImZpbGxDdWlzaW5lc0hUTUwiLCJzZWxlY3QiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiZm9yRWFjaCIsIm9wdGlvbiIsImNyZWF0ZUVsZW1lbnQiLCJpbm5lckhUTUwiLCJjdWlzaW5lIiwidmFsdWUiLCJhcHBlbmQiLCJmZXRjaEN1aXNpbmVzIiwiREJIZWxwZXIiLCJlcnJvciIsImZpbGxOZWlnaGJvcmhvb2RzSFRNTCIsIm5laWdoYm9yaG9vZCIsImFwcGVuZFJlc3RhdXJhbnRJbWFnZSIsInJlc3RhdXJhbnQiLCJsaSIsImltYWdlIiwiY2xhc3NOYW1lIiwic3JjIiwiaW1hZ2VVcmxGb3JSZXN0YXVyYW50IiwiYWx0IiwibmFtZSIsImFwcGVuZFJlc3RhdXJhbnRUaXRsZSIsImFwcGVuZFJlc3RhdXJhbnROZWlnaGJvcmhvb2QiLCJhcHBlbmRSZXN0YXVyYW50QWRkcmVzcyIsImFkZHJlc3MiLCJhcHBlbmRSZXN0YXVyYW50RGV0YWlscyIsIm1vcmUiLCJocmVmIiwidXJsRm9yUmVzdGF1cmFudCIsImFkZE1hcmtlcnNUb01hcCIsIm1hcmtlciIsIm1hcE1hcmtlckZvclJlc3RhdXJhbnQiLCJzZWxmIiwiZ29vZ2xlIiwibWFwcyIsImV2ZW50IiwiYWRkTGlzdGVuZXIiLCJ3aW5kb3ciLCJsb2NhdGlvbiIsInVybCIsInB1c2giLCJhcHBlbmRSZXN0YXVyYW50SXRlbXMiLCJjcmVhdGVSZXN0YXVyYW50SFRNTCIsImZpbGxSZXN0YXVyYW50c0hUTUwiLCJ1bCIsImZldGNoTmVpZ2hib3Job29kcyIsIm5laWdoYm9yaG9vZHNMaXN0IiwicmVzZXRSZXN0YXVyYW50cyIsIm0iLCJzZXRNYXAiLCJyZXN0YXVyYW50c0xpc3QiLCJ1cGRhdGVSZXN0YXVyYW50cyIsImNTZWxlY3QiLCJuU2VsZWN0IiwiY0luZGV4Iiwic2VsZWN0ZWRJbmRleCIsIm5JbmRleCIsImZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZUFuZE5laWdoYm9yaG9vZCIsImFkZEV2ZW50TGlzdGVuZXIiLCJpbml0TWFwIiwibG9jIiwibGF0IiwibG5nIiwiTWFwIiwiem9vbSIsImNlbnRlciIsInNjcm9sbHdoZWVsIiwibG9hZGVkTWFwIiwicXVlcnlTZWxlY3RvckFsbCIsIml0ZW0iLCJzZXRBdHRyaWJ1dGUiXSwibWFwcGluZ3MiOiJjQUFBO0FBQ0E7QUFDQTtBQUNBLElBQUlBLG9CQUFKO0FBQ0EsSUFBSUMsc0JBQUo7QUFDQSxJQUFJQyxpQkFBSjtBQUNBLElBQUlDLFlBQUo7QUFDQSxJQUFJQyxVQUFVLEVBQWQ7O0FBRUE7Ozs7QUFJQSxJQUFJLG1CQUFtQkMsU0FBdkIsRUFBa0M7QUFDaENBLFlBQVVDLGFBQVYsQ0FBd0JDLFFBQXhCLENBQWlDLFNBQWpDLEVBQTRDQyxJQUE1QyxDQUFpRCxZQUFNO0FBQ3JEQyxZQUFRQyxHQUFSLENBQVksNEJBQVo7QUFDRCxHQUZEO0FBR0NDLE9BSEQsQ0FHTyxlQUFPO0FBQ1pGLFlBQVFDLEdBQVIsQ0FBWUUsR0FBWjtBQUNELEdBTEQ7QUFNRDs7QUFFRDs7O0FBR0EsSUFBTUMsbUJBQW1CLFNBQW5CQSxnQkFBbUIsR0FBTTtBQUM3QixNQUFNQyxTQUFTQyxTQUFTQyxjQUFULENBQXdCLGlCQUF4QixDQUFmO0FBQ0FkLFdBQVNlLE9BQVQsQ0FBaUIsbUJBQVc7QUFDMUIsUUFBTUMsU0FBU0gsU0FBU0ksYUFBVCxDQUF1QixRQUF2QixDQUFmO0FBQ0FELFdBQU9FLFNBQVAsR0FBbUJDLE9BQW5CO0FBQ0FILFdBQU9JLEtBQVAsR0FBZUQsT0FBZjtBQUNBUCxXQUFPUyxNQUFQLENBQWNMLE1BQWQ7QUFDRCxHQUxEO0FBTUQsQ0FSRDs7QUFVQTs7O0FBR0EsSUFBTU0s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TUFBTTtBQUNSQyxTQUFLLFNBREc7QUFFUkMsU0FBSyxDQUFDLFNBRkUsRUFBVjs7QUFJQTVFLFFBQU0sSUFBSStDLE9BQU9DLElBQVAsQ0FBWTZCLEdBQWhCLENBQW9CakUsU0FBU0MsY0FBVCxDQUF3QixLQUF4QixDQUFwQixFQUFvRDtBQUN4RGlFLFVBQU0sRUFEa0Q7QUFFeERDLFlBQVFMLEdBRmdEO0FBR3hETSxpQkFBYSxLQUgyQyxFQUFwRCxDQUFOOztBQUtBLE1BQU1DLFlBQVlqRixHQUFsQjtBQUNBO0FBQ0ErQyxTQUFPQyxJQUFQLENBQVlDLEtBQVosQ0FBa0JDLFdBQWxCLENBQThCK0IsU0FBOUIsRUFBeUMsYUFBekMsRUFBd0QsWUFBTTtBQUM1RHJFLGFBQVNzRSxnQkFBVCxDQUEwQixRQUExQixFQUFvQ3BFLE9BQXBDLENBQTRDLGdCQUFRO0FBQ2xEcUUsV0FBS0MsWUFBTCxDQUFrQixVQUFsQixFQUE4QixJQUE5QjtBQUNELEtBRkQ7QUFHQXhFLGFBQVNzRSxnQkFBVCxDQUEwQixXQUExQixFQUF1Q3BFLE9BQXZDLENBQStDLGdCQUFRO0FBQ3JEcUUsV0FBS0MsWUFBTCxDQUFrQixVQUFsQixFQUE4QixJQUE5QjtBQUNELEtBRkQ7QUFHRCxHQVBEO0FBUUFuQjtBQUNELENBckJEIiwiZmlsZSI6Im1haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBlc2xpbnQtZW52IGJyb3dzZXIsIG5vLXVudXNlZC12YXJzOiBcIm9mZlwiICovXG4vKiBnbG9iYWwgIERCSGVscGVyLCBnb29nbGUgKi9cbi8qICovXG5sZXQgcmVzdGF1cmFudHM7XG5sZXQgbmVpZ2hib3Job29kcztcbmxldCBjdWlzaW5lcztcbmxldCBtYXA7XG5sZXQgbWFya2VycyA9IFtdO1xuXG4vKipcbiAqIEFkZCBzZXJ2aWNlIHdvcmtlciB0byBtYWluIHBhZ2VcbiAqL1xuXG5pZiAoJ3NlcnZpY2VXb3JrZXInIGluIG5hdmlnYXRvcikge1xuICBuYXZpZ2F0b3Iuc2VydmljZVdvcmtlci5yZWdpc3RlcignLi9zdy5qcycpLnRoZW4oKCkgPT4ge1xuICAgIGNvbnNvbGUubG9nKCdzZXJ2aWNlIHdvcmtlciByZWdpc3RlcmVkIScpO1xuICB9KVxuICAuY2F0Y2goZXJyID0+IHtcbiAgICBjb25zb2xlLmxvZyhlcnIpO1xuICB9KTtcbn1cblxuLyoqXG4gKiBTZXQgY3Vpc2luZXMgSFRNTC5cbiAqL1xuY29uc3QgZmlsbEN1aXNpbmVzSFRNTCA9ICgpID0+IHtcbiAgY29uc3Qgc2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2N1aXNpbmVzLXNlbGVjdCcpO1xuICBjdWlzaW5lcy5mb3JFYWNoKGN1aXNpbmUgPT4ge1xuICAgIGNvbnN0IG9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpO1xuICAgIG9wdGlvbi5pbm5lckhUTUwgPSBjdWlzaW5lO1xuICAgIG9wdGlvbi52YWx1ZSA9IGN1aXNpbmU7XG4gICAgc2VsZWN0LmFwcGVuZChvcHRpb24pO1xuICB9KTtcbn07XG5cbi8qKlxuICogRmV0Y2ggYWxsIGN1aXNpbmVzIGFuZCBzZXQgdGhlaXIgSFRNTC5cbiAqL1xuY29uc3QgZmV0Y2hDdWlzaW5lcyA9ICgpID0+IHtcbiAgREJIZWxwZXIuZmV0Y2hDdWlzaW5lcygoZXJyb3IsIGN1aXNpbmVzKSA9PiB7XG4gICAgaWYgKGVycm9yKSB7XG4gICAgICAvLyBHb3QgYW4gZXJyb3IhXG4gICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY3Vpc2luZXMgPSBjdWlzaW5lcztcbiAgICAgIGZpbGxDdWlzaW5lc0hUTUwoKTtcbiAgICB9XG4gIH0pO1xufTtcblxuLyoqXG4gKiBTZXQgbmVpZ2hib3Job29kcyBIVE1MLlxuICovXG5jb25zdCBmaWxsTmVpZ2hib3Job29kc0hUTUwgPSAoKSA9PiB7XG4gIGNvbnN0IHNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduZWlnaGJvcmhvb2RzLXNlbGVjdCcpO1xuICBuZWlnaGJvcmhvb2RzLmZvckVhY2gobmVpZ2hib3Job29kID0+IHtcbiAgICBjb25zdCBvcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKTtcbiAgICBvcHRpb24uaW5uZXJIVE1MID0gbmVpZ2hib3Job29kO1xuICAgIG9wdGlvbi52YWx1ZSA9IG5laWdoYm9yaG9vZDtcbiAgICBzZWxlY3QuYXBwZW5kKG9wdGlvbik7XG4gIH0pO1xufTtcblxuY29uc3QgYXBwZW5kUmVzdGF1cmFudEltYWdlID0gKHJlc3RhdXJhbnQsIGxpKSA9PiB7XG4gIGNvbnN0IGltYWdlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW1nJyk7XG4gIGltYWdlLmNsYXNzTmFtZSA9ICdyZXN0YXVyYW50LWltZyc7XG4gIGltYWdlLnNyYyA9IERCSGVscGVyLmltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KTtcbiAgaW1hZ2UuYWx0ID0gYFJlc3RhdXJhbnQ6ICR7cmVzdGF1cmFudC5uYW1lfWA7XG4gIGxpLmFwcGVuZChpbWFnZSk7XG59O1xuXG5jb25zdCBhcHBlbmRSZXN0YXVyYW50VGl0bGUgPSAocmVzdGF1cmFudCwgbGkpID0+IHtcbiAgY29uc3QgbmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2gzJyk7XG4gIG5hbWUuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uYW1lO1xuICBsaS5hcHBlbmQobmFtZSk7XG59O1xuXG5jb25zdCBhcHBlbmRSZXN0YXVyYW50TmVpZ2hib3Job29kID0gKHJlc3RhdXJhbnQsIGxpKSA9PiB7XG4gIGNvbnN0IG5laWdoYm9yaG9vZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgbmVpZ2hib3Job29kLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmVpZ2hib3Job29kO1xuICBsaS5hcHBlbmQobmVpZ2hib3Job29kKTtcbn07XG5cbmNvbnN0IGFwcGVuZFJlc3RhdXJhbnRBZGRyZXNzID0gKHJlc3RhdXJhbnQsIGxpKSA9PiB7XG4gIGNvbnN0IGFkZHJlc3MgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gIGFkZHJlc3MuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5hZGRyZXNzO1xuICBsaS5hcHBlbmQoYWRkcmVzcyk7XG59O1xuXG5jb25zdCBhcHBlbmRSZXN0YXVyYW50RGV0YWlscyA9IChyZXN0YXVyYW50LCBsaSkgPT4ge1xuICBjb25zdCBtb3JlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpO1xuICBtb3JlLmlubmVySFRNTCA9ICdWaWV3IERldGFpbHMnO1xuICBtb3JlLmhyZWYgPSBEQkhlbHBlci51cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpO1xuICBsaS5hcHBlbmQobW9yZSk7XG59O1xuXG4vKipcbiAqIEFkZCBtYXJrZXJzIGZvciBjdXJyZW50IHJlc3RhdXJhbnRzIHRvIHRoZSBtYXAuXG4gKi9cbmNvbnN0IGFkZE1hcmtlcnNUb01hcCA9ICgpID0+IHtcbiAgcmVzdGF1cmFudHMuZm9yRWFjaChyZXN0YXVyYW50ID0+IHtcbiAgICAvLyBBZGQgbWFya2VyIHRvIHRoZSBtYXBcbiAgICBjb25zdCBtYXJrZXIgPSBEQkhlbHBlci5tYXBNYXJrZXJGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQsIHNlbGYubWFwKTtcbiAgICBnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihtYXJrZXIsICdjbGljaycsICgpID0+IHtcbiAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gbWFya2VyLnVybDtcbiAgICB9KTtcbiAgICBzZWxmLm1hcmtlcnMucHVzaChtYXJrZXIpO1xuICB9KTtcbn07XG5cbmNvbnN0IGFwcGVuZFJlc3RhdXJhbnRJdGVtcyA9IChyZXN0YXVyYW50LCBsaSkgPT4ge1xuICBhcHBlbmRSZXN0YXVyYW50SW1hZ2UocmVzdGF1cmFudCwgbGkpO1xuICBhcHBlbmRSZXN0YXVyYW50VGl0bGUocmVzdGF1cmFudCwgbGkpO1xuICBhcHBlbmRSZXN0YXVyYW50TmVpZ2hib3Job29kKHJlc3RhdXJhbnQsIGxpKTtcbiAgYXBwZW5kUmVzdGF1cmFudEFkZHJlc3MocmVzdGF1cmFudCwgbGkpO1xuICBhcHBlbmRSZXN0YXVyYW50RGV0YWlscyhyZXN0YXVyYW50LCBsaSk7XG59O1xuXG4vKipcbiAqIENyZWF0ZSByZXN0YXVyYW50IEhUTUwuXG4gKiBAcGFyYW0geyp9IHJlc3RhdXJhbnQgcmVzdGF1cm5hIG9iamVjdFxuICogQHJldHVybiB7Kn0gSFRNTCBFbGVtZW50XG4gKi9cbmNvbnN0IGNyZWF0ZVJlc3RhdXJhbnRIVE1MID0gcmVzdGF1cmFudCA9PiB7XG4gIGNvbnN0IGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcbiAgYXBwZW5kUmVzdGF1cmFudEl0ZW1zKHJlc3RhdXJhbnQsIGxpKTtcbiAgcmV0dXJuIGxpO1xufTtcblxuLyoqXG4gKiBDcmVhdGUgYWxsIHJlc3RhdXJhbnRzIEhUTUwgYW5kIGFkZCB0aGVtIHRvIHRoZSB3ZWJwYWdlLlxuICovXG5jb25zdCBmaWxsUmVzdGF1cmFudHNIVE1MID0gKCkgPT4ge1xuICBjb25zdCB1bCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50cy1saXN0Jyk7XG4gIHJlc3RhdXJhbnRzLmZvckVhY2gocmVzdGF1cmFudCA9PiB7XG4gICAgdWwuYXBwZW5kKGNyZWF0ZVJlc3RhdXJhbnRIVE1MKHJlc3RhdXJhbnQpKTtcbiAgfSk7XG4gIGFkZE1hcmtlcnNUb01hcCgpO1xufTtcbi8qKlxuICogRmV0Y2ggYWxsIG5laWdoYm9yaG9vZHMgYW5kIHNldCB0aGVpciBIVE1MLlxuICovXG5jb25zdCBmZXRjaE5laWdoYm9yaG9vZHMgPSAoKSA9PiB7XG4gIERCSGVscGVyLmZldGNoTmVpZ2hib3Job29kcygoZXJyb3IsIG5laWdoYm9yaG9vZHNMaXN0KSA9PiB7XG4gICAgaWYgKGVycm9yKSB7XG4gICAgICAvLyBHb3QgYW4gZXJyb3JcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgIH0gZWxzZSB7XG4gICAgICBuZWlnaGJvcmhvb2RzID0gbmVpZ2hib3Job29kc0xpc3Q7XG4gICAgICBmaWxsTmVpZ2hib3Job29kc0hUTUwoKTtcbiAgICB9XG4gIH0pO1xufTtcblxuLyoqXG4gKiBAZGVzYyBDbGVhciBjdXJyZW50IHJlc3RhdXJhbnRzLCB0aGVpciBIVE1MIGFuZCByZW1vdmUgdGhlaXIgbWFwIG1hcmtlcnMuXG4gKiBAcGFyYW0geyp9IHJlc3RhdXJhbnRzTGlzdCB0b2RvOiBhZGQgbGlzdCBkZXNjcmlwdGlvblxuICovXG5jb25zdCByZXNldFJlc3RhdXJhbnRzID0gcmVzdGF1cmFudHNMaXN0ID0+IHtcbiAgLy8gUmVtb3ZlIGFsbCByZXN0YXVyYW50c1xuICByZXN0YXVyYW50cyA9IFtdO1xuICBjb25zdCB1bCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50cy1saXN0Jyk7XG4gIHVsLmlubmVySFRNTCA9ICcnO1xuXG4gIC8vIFJlbW92ZSBhbGwgbWFwIG1hcmtlcnNcbiAgbWFya2Vycy5mb3JFYWNoKG0gPT4gbS5zZXRNYXAobnVsbCkpO1xuICBtYXJrZXJzID0gW107XG4gIHJlc3RhdXJhbnRzID0gcmVzdGF1cmFudHNMaXN0O1xufTtcblxuLyoqXG4gKiBVcGRhdGUgcGFnZSBhbmQgbWFwIGZvciBjdXJyZW50IHJlc3RhdXJhbnRzLlxuICovXG5jb25zdCB1cGRhdGVSZXN0YXVyYW50cyA9ICgpID0+IHtcbiAgY29uc3QgY1NlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjdWlzaW5lcy1zZWxlY3QnKTtcbiAgY29uc3QgblNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduZWlnaGJvcmhvb2RzLXNlbGVjdCcpO1xuXG4gIGNvbnN0IGNJbmRleCA9IGNTZWxlY3Quc2VsZWN0ZWRJbmRleDtcbiAgY29uc3QgbkluZGV4ID0gblNlbGVjdC5zZWxlY3RlZEluZGV4O1xuXG4gIGNvbnN0IGN1aXNpbmUgPSBjU2VsZWN0W2NJbmRleF0udmFsdWU7XG4gIGNvbnN0IG5laWdoYm9yaG9vZCA9IG5TZWxlY3RbbkluZGV4XS52YWx1ZTtcblxuICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2QoY3Vpc2luZSwgbmVpZ2hib3Job29kLFxuICAgIChlcnJvciwgcmVzdGF1cmFudHNMaXN0KSA9PiB7XG4gICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgLy8gR290IGFuIGVycm9yIVxuICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJlc2V0UmVzdGF1cmFudHMocmVzdGF1cmFudHNMaXN0KTtcbiAgICAgICAgZmlsbFJlc3RhdXJhbnRzSFRNTCgpO1xuICAgICAgfVxuICAgIH0pO1xufTtcblxuLyoqXG4gKiBGZXRjaCBuZWlnaGJvcmhvb2RzIGFuZCBjdWlzaW5lcyBhcyBzb29uIGFzIHRoZSBwYWdlIGlzIGxvYWRlZC5cbiAqL1xuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsICgpID0+IHtcbiAgZmV0Y2hOZWlnaGJvcmhvb2RzKCk7XG4gIGZldGNoQ3Vpc2luZXMoKTtcbn0pO1xuXG4vKipcbiAqIEluaXRpYWxpemUgR29vZ2xlIG1hcCwgY2FsbGVkIGZyb20gSFRNTC5cbiAqL1xud2luZG93LmluaXRNYXAgPSAoKSA9PiB7XG4gIGxldCBsb2MgPSB7XG4gICAgbGF0OiA0MC43MjIyMTYsXG4gICAgbG5nOiAtNzMuOTg3NTAxXG4gIH07XG4gIG1hcCA9IG5ldyBnb29nbGUubWFwcy5NYXAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hcCcpLCB7XG4gICAgem9vbTogMTIsXG4gICAgY2VudGVyOiBsb2MsXG4gICAgc2Nyb2xsd2hlZWw6IGZhbHNlXG4gIH0pO1xuICBjb25zdCBsb2FkZWRNYXAgPSBtYXA7XG4gIC8vIGRpc2FibGUga2V5Ym9hcmQgbmF2aWdhdGlvbiBmb3IgZ29vZ2xlIG1hcHNcbiAgZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIobG9hZGVkTWFwLCAndGlsZXNsb2FkZWQnLCAoKSA9PiB7XG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnI21hcCBhJykuZm9yRWFjaChpdGVtID0+IHtcbiAgICAgIGl0ZW0uc2V0QXR0cmlidXRlKCd0YWJpbmRleCcsICctMScpO1xuICAgIH0pO1xuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJyNtYXAgYXJlYScpLmZvckVhY2goaXRlbSA9PiB7XG4gICAgICBpdGVtLnNldEF0dHJpYnV0ZSgndGFiaW5kZXgnLCAnLTEnKTtcbiAgICB9KTtcbiAgfSk7XG4gIHVwZGF0ZVJlc3RhdXJhbnRzKCk7XG59O1xuIl19
