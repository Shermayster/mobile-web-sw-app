"use strict";var _createClass=function(){function a(e,n){for(var t=0;t<n.length;t++){var a=n[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(e,n,t){return n&&a(e.prototype,n),t&&a(e,t),e}}();function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var online=navigator.onLine,marked=!1;"serviceWorker"in navigator&&navigator.serviceWorker.register("./sw.js").then(function(){console.log("service worker registered!")}).catch(function(e){console.log(e)});var map=void 0,Main=function(){function e(){_classCallCheck(this,e),this.restaurants=null,this.neighborhoods=null,this.cuisines=null,this.markers=[]}return _createClass(e,[{key:"fillCuisinesHTML",value:function(){var t=document.getElementById("cuisines-select");this.cuisines.forEach(function(e){var n=document.createElement("option");n.innerHTML=e,n.value=e,t.append(n)})}},{key:"fetchCuisines",value:function(){var n=this;DBHelper.fetchCuisines().then(function(e){n.cuisines=e,n.fillCuisinesHTML()},function(e){return console.log(e)})}},{key:"fillNeighborhoodsHTML",value:function(){var t=document.getElementById("neighborhoods-select");this.neighborhoods.forEach(function(e){var n=document.createElement("option");n.innerHTML=e,n.value=e,t.append(n)})}},{key:"appendRestaurantImage",value:function(e,n){var t=document.createElement("picture"),a=DBHelper.imageUrlForRestaurant(e),r="Restaurant: "+e.name;ImageHelper.creatSourcesForPicture(a,r).forEach(function(e){return t.append(e)}),t.className="lazyload",n.append(t)}},{key:"appendRestaurantTitle",value:function(e,n){var t=document.createElement("h3");t.innerHTML=e.name,n.append(t)}},{key:"appendRestaurantNeighborhood",value:function(e,n){var t=document.createElement("p");t.innerHTML=e.neighborhood,n.append(t)}},{key:"appendRestaurantAddress",value:function(e,n){var t=document.createElement("p");t.innerHTML=e.address,n.append(t)}},{key:"appendRestaurantDetails",value:function(e,n){var t=document.createElement("a");t.innerHTML="View Details",t.href=DBHelper.urlForRestaurant(e),n.append(t)}},{key:"addMarkersToMap",value:function(){var t=this;"block"===this.getMapDisplayProperty()&&(this.restaurants.forEach(function(e){var n=DBHelper.mapMarkerForRestaurant(e,map);google.maps.event.addListener(n,"click",function(){window.location.href=n.url}),t.markers.push(n)}),marked=!0)}},{key:"getMapDisplayProperty",value:function(){var e=document.querySelector("#map");return window.getComputedStyle(e,null).getPropertyValue("display")}},{key:"appendRestaurantItems",value:function(e,n){this.appendRestaurantImage(e,n),this.appendRestaurantTitle(e,n),this.appendRestaurantNeighborhood(e,n),this.appendRestaurantAddress(e,n),this.appendRestaurantDetails(e,n)}},{key:"createRestaurantHTML",value:function(e){var n=document.createElement("li");return this.appendRestaurantItems(e,n),n}},{key:"fillRestaurantsHTML",value:function(){var n=this,t=document.getElementById("restaurants-list");this.restaurants.forEach(function(e){t.append(n.createRestaurantHTML(e))}),this.addMarkersToMap()}},{key:"fetchNeighborhoods",value:function(){var n=this;DBHelper.fetchNeighborhoods().then(function(e){n.neighborhoods=e,n.fillNeighborhoodsHTML()})}},{key:"resetRestaurants",value:function(e){this.restaurants=[],document.getElementById("restaurants-list").innerHTML="",this.markers.forEach(function(e){return e.setMap(null)}),this.markers=[],this.restaurants=e}},{key:"updateRestaurants",value:function(){var n=this,e=document.getElementById("cuisines-select"),t=document.getElementById("neighborhoods-select"),a=e.selectedIndex,r=t.selectedIndex,o=e[a].value,i=t[r].value;DBHelper.fetchRestaurantByCuisineAndNeighborhood(o,i).then(function(e){n.resetRestaurants(e),n.fillRestaurantsHTML()},function(e){return console.log(e)})}}]),e}(),main=new Main;document.addEventListener("DOMContentLoaded",function(){main.fetchNeighborhoods(),main.fetchCuisines(),main.updateRestaurants()}),window.onload=function(){navigator.onLine&&initMap()};var accBtn=document.querySelector(".accordion");function getScreenWidth(){return window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth}function getAccordionText(e){return"SHOW MAP"===e?"HIDE MAP":"SHOW MAP"}function initMap(){var e=map=new google.maps.Map(document.getElementById("map"),{zoom:12,center:{lat:40.722216,lng:-73.987501},scrollwheel:!1});google.maps.event.addListener(e,"tilesloaded",function(){document.querySelectorAll("#map a").forEach(function(e){e.setAttribute("tabindex","-1")}),document.querySelectorAll("#map area").forEach(function(e){e.setAttribute("tabindex","-1")})}),main.addMarkersToMap()}online?accBtn.addEventListener("click",function(){document.querySelector("#map").classList.toggle("show"),accBtn.classList.toggle("active"),accBtn.innerText=getAccordionText(accBtn.innerText),marked||main.addMarkersToMap()}):accBtn.style.display="none",window.addEventListener("deviceorientation",function(){699<getScreenWidth()&&main.addMarkersToMap()});